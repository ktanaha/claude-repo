# セキュリティ・安全性ルール

## 危険なコマンドの実行制限
以下のコマンドは**絶対に無断で実行しない**。必ずユーザーに確認を取る：

- `rm` / `rm -rf` - ファイル・ディレクトリの削除
- `sudo rm` - 管理者権限での削除
- `dd` - ディスクの直接書き込み
- `chmod 777` - 危険な権限変更
- `sudo` 全般 - 管理者権限が必要な操作
- `curl | sh` / `wget | sh` - 未検証スクリプトの実行

## 実行前確認が必要な操作
- ファイルの移動・削除
- システム設定の変更
- 外部からのスクリプトダウンロード・実行
- データベースの変更・削除操作

## 確認方法
危険な操作を提案する際は、以下の情報を含めて確認を求める：
- 実行するコマンドの詳細
- 影響範囲の説明
- 元に戻す方法（可能な場合）

## セキュリティベストプラクティス

### 開発時のセキュリティ
- **環境変数**: 機密情報は.envファイルに保存し、.gitignoreに必ず追加
- **ハードコーディング禁止**: APIキー、パスワード、秘密鍵をソースコードに記述しない
- **ログ出力**: 個人情報や機密情報をログに出力しない
- **依存関係**: 定期的な脆弱性スキャンを実施

### データベースセキュリティ
- **SQLインジェクション対策**: プリペアドステートメントを使用
- **認証**: 強固なパスワードポリシーを実装
- **アクセス制御**: 最小権限の原則を適用
- **暗号化**: 機密データの暗号化を実装

### API セキュリティ
- **認証・認可**: JWT トークンまたはOAuth 2.0を使用
- **CORS設定**: 適切なオリジン制御を実装
- **レート制限**: API呼び出し回数の制限を実装
- **入力検証**: すべての入力値の検証を実施

### フロントエンドセキュリティ
- **XSS対策**: 適切なサニタイゼーションを実装
- **CSRF対策**: CSRFトークンを使用
- **Content Security Policy**: CSPヘッダーを設定
- **HTTPS**: すべての通信をHTTPSで行う

# claude.mdセキュリティチェックリスト

## 認証・Cookie設定

### Cookie属性の確認
- [ ] **HttpOnly属性**が設定されていること（XSS緩和策）
- [ ] **SameSite属性**がLaxまたはStrictに設定されていること（CSRF対策）
- [ ] **Secure属性**が設定されていること（HTTPS通信でのみ送信）
- [ ] **Domain属性**が適切に設定されていること
- [ ] Cookie名の接頭辞として`__Host-`の使用を検討すること

## 入力値バリデーション

### サーバーサイドバリデーション
- [ ] **クライアント側だけでなくサーバーサイドでもバリデーション**が実装されていること
- [ ] **URLバリデーション**でprotocol制限（`javascript:`の防止など）がされていること
- [ ] **正規表現のバイパス対策**が考慮されていること

### XSS対策
- [ ] **HTMLの直接出力**（`innerHTML`、`dangerouslySetInnerHTML`等）でのエスケープ処理
- [ ] **ユーザー入力値の表示時**にエスケープ・サニタイズが実装されていること

### SQLインジェクション対策
- [ ] **SQLインジェクションが発生する可能性**が排除されていること
- [ ] **DELETE/UPDATE文のWHERE条件**が適切に設定されていること

### ユーザー指定データの制限
- [ ] **ハンドルネーム等のURL含有データ**でアプリケーションパスとの競合チェック
- [ ] **リザーブド文字列**（admin、contact等）の登録拒否設定
- [ ] **アンダースコア開始文字列**の拒否（クラウドサービス予約文字対策）

## レスポンスヘッダセキュリティ

### 必須セキュリティヘッダ
- [ ] **Strict-Transport-Security**ヘッダの設定
- [ ] **X-Frame-Options**（DENY/SAMEORIGIN）またはCSPのframe-ancestorsの設定
- [ ] **X-Content-Type-Options: nosniff**の設定

## 認証・アクセス制御

### アクセス権限管理  
- [ ] **重要操作（退会・メアドリセット等）での直前ログイン必須**化
- [ ] **権限のない更新・削除操作**の防止
- [ ] **未認証ユーザーのデータ操作**防止

### ログイン機能
- [ ] **メールアドレス本人確認**の実装
- [ ] **登録メールアドレス列挙攻撃**の防止
- [ ] **複数ログイン方法の統合仕様**の決定と実装

## その他重要なセキュリティ対策

### データ保護
- [ ] **ユーザー依存レスポンスのキャッシュ**回避
- [ ] **オブジェクトストレージディレクトリページ**の非公開設定
- [ ] **オープンリダイレクト対策**の実装

### エラーハンドリング・情報漏洩防止
- [ ] **サーバーエラーメッセージ**の直接表示禁止
- [ ] **レスポンスヘッダへのユーザー入力値**の直接含有禁止

### ファイルアップロード
- [ ] **ファイル形式・サイズ・ファイル名**のバリデーション実装

### バックアップ・アカウントセキュリティ
- [ ] **DBの定期バックアップ**有効化
- [ ] **オブジェクトストレージバックアップ**有効化  
- [ ] **クラウドサービスアカウントの二要素認証**有効化

### メール送信セキュリティ
- [ ] **ユーザー入力値を含むメール**でのスパム防止対策
- [ ] **大量メール送信**での重複送信防止
- [ ] **SPF/DKIM/DMARC**の設定完了

## 追加考慮事項
- [ ] **CSP（Content Security Policy）**の設定検討
- [ ] **利用ライブラリの脆弱性**チェック（npm audit等）
- [ ] **セキュリティテスト**の実施