# Claude Code開発ガイドライン

## 言語設定・コミュニケーション方針
- **応答言語**: すべての応答を日本語で行う
- **コメント**: コード内のコメントも日本語で記述
- **説明**: 技術的な説明や手順も日本語で提供
- **プロジェクト全体**: すべてのやり取りを日本語で統一

---

# 開発手順の強制ルール

## t-wada式TDD必須プロセス
**すべての開発作業は以下の手順で進める**（例外なし）：

### 1. Red（失敗するテストを先に書く）
- 実装前に期待する動作をテストで定義
- テストが失敗することを確認
- テストの失敗理由を明確に把握

### 2. Green（テストを通す最小限の実装）
- 美しさより動作を優先
- テストが通ることのみを目的とする
- 実装の詳細は後で改善

### 3. Refactor（動作を変えずに改善）
- 動作を変更しない
- 各改善ステップでテスト実行
- コードの品質を向上させる

## 作業開始時の必須チェックリスト
**どんな機能開発でも、最初に以下を確認**：
- [ ] テストが書かれているか？
- [ ] テストが失敗するか？
- [ ] 実装はテストを通すだけか？
- [ ] リファクタリングでテストは通ったままか？

## 禁止事項（例外なし）
- 「とりあえず動くものを」→ 禁止
- 「テストは後で」→ 禁止
- 「簡単だからテスト不要」→ 禁止

**一行でもコードを書く前に、必ずテストから始める**

---

# アーキテクチャ・技術スタック

## 基本方針
フロントエンド・バックエンド分離アーキテクチャを必須とする

## 技術スタック
- **フロントエンド**: React (TypeScript必須)
- **バックエンド**: Go
- **開発環境**: Docker + Docker Compose
- **API通信**: RESTful API または GraphQL

## プロジェクト構成
```
project/
├── frontend/           # React アプリケーション
├── backend/           # Go API サーバー
├── docker-compose.yml # 開発環境定義
└── docs/             # API仕様書等
```

## バックエンドアーキテクチャ（Go）
- **小規模**: レイヤードアーキテクチャ
- **中規模以上**: クリーンアーキテクチャ

```
backend/
├── cmd/              # エントリーポイント
├── internal/
│   ├── domain/       # エンティティ、ビジネスルール
│   ├── usecase/      # アプリケーションロジック
│   ├── interface/    # コントローラー、プレゼンター
│   └── infrastructure/ # DB、外部API実装
└── pkg/              # 共通ライブラリ
```

## フロントエンドアーキテクチャ（React）
- **コンポーネント設計**: Atomic Design
- **状態管理**: Context API または Redux Toolkit

```
frontend/
├── src/
│   ├── components/   # UI コンポーネント
│   ├── hooks/        # カスタムフック
│   ├── services/     # API通信
│   ├── stores/       # 状態管理
│   └── types/        # TypeScript型定義
└── public/
```

---

# テスト戦略

## テストツール
- **フロントエンド**: Jest + React Testing Library
- **バックエンド**: Go標準testingパッケージ + testify
- **E2E**: Cypress または Playwright

## リファクタリング戦略

### Martin Fowler式リファクタリング手法
**基本原則**：
- 動作を変えずに内部構造を改善
- 小さなステップで安全に進める
- 各ステップでテストを実行
- リファクタリングと機能追加は分離

**主要なリファクタリングパターン**：
- **Extract Method**: 長いメソッドを分割
- **Rename Variable/Function**: 意図を明確にする命名
- **Move Method**: 適切なクラス・モジュールに移動
- **Extract Class**: 責任が多すぎるクラスを分割
- **Inline Temp**: 不要な一時変数を除去

### コードスメルの除去優先順位
1. 重複コード（DRY原則違反）
2. 長すぎる関数・メソッド
3. 大きすぎるクラス
4. 長すぎるパラメータリスト
5. 不適切な命名

---

# Docker開発環境

## 必須構成
```yaml
# docker-compose.yml テンプレート
version: '3.8'
services:
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    volumes:
      - ./frontend:/app
  
  backend:
    build: ./backend
    ports:
      - "8080:8080"
    volumes:
      - ./backend:/app
    environment:
      - GO_ENV=development
  
  db:
    image: postgres:15
    environment:
      POSTGRES_DB: app_db
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
```

---

# 開発指示テンプレート

## プロジェクト初期化
```
「React + Go + Dockerの開発環境をセットアップしてください。
- フロントエンドはReact with TypeScript
- バックエンドはGoでクリーンアーキテクチャ
- Docker Composeで開発環境構築
- 各環境のバージョンは整合性がとれるものを選択
- 各層のテスト環境も含める」
```

## API開発時（バックエンド）
```
「[API名]を実装してください。
- TDDで進める（Red-Green-Refactor厳守）
- Goでクリーンアーキテクチャ適用
- OpenAPI 3.0.3仕様書も生成
- ドメインロジックを中心に設計」
```

## UI開発時（フロントエンド）
```
「[コンポーネント名]を実装してください。
- TDDで進める（Red-Green-Refactor厳守）
- React + TypeScript
- Atomic Designパターン
- React Testing Libraryでテスト
- APIとの通信部分は分離」
```

## リファクタリング時
```
「このコードをリファクタリングしてください。
- 既存のテストを保持（動作変更なし）
- 小さなステップで段階的に改善
- 各ステップでテスト実行
- SOLID原則とDRY原則を適用
- 可読性とメンテナンス性を向上」
```

---

# 開発フロー

1. **環境構築**: Docker Composeで開発環境立ち上げ
2. **API設計**: OpenAPI 3.0.3仕様書作成
3. **バックエンド開発**: TDDでAPI実装
4. **継続的リファクタリング**: 機能実装後に小さなステップで改善
5. **フロントエンド開発**: モックAPIでUI作成
6. **フロントエンドリファクタリング**: コンポーネント設計改善
7. **統合**: 実際のAPIと接続
8. **E2Eテスト**: 全体動作確認

---

# セキュリティ・安全性ルール

## 危険なコマンドの実行制限
以下のコマンドは**絶対に無断で実行しない**。必ずユーザーに確認を取る：

- `rm` / `rm -rf` - ファイル・ディレクトリの削除
- `sudo rm` - 管理者権限での削除
- `dd` - ディスクの直接書き込み
- `chmod 777` - 危険な権限変更
- `sudo` 全般 - 管理者権限が必要な操作
- `curl | sh` / `wget | sh` - 未検証スクリプトの実行

## 実行前確認が必要な操作
- ファイルの移動・削除
- システム設定の変更
- 外部からのスクリプトダウンロード・実行
- データベースの変更・削除操作

## 確認方法
危険な操作を提案する際は、以下の情報を含めて確認を求める：
- 実行するコマンドの詳細
- 影響範囲の説明
- 元に戻す方法（可能な場合）

---

# 例外ケース

以下の場合のみ、シンプルな構造を許可：
- プロトタイプや学習目的
- 極小規模（単一ファイル）
- 一時的なスクリプト

**その場合も最低限のテストは必須**